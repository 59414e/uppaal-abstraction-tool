{
  "nta": {
    "declaration": [
      "// Place global declarations here.\nconst int N_V = 1;\nconst int N_C = 1;\ntypedef int[1, N_V] v_t;\ntypedef int[1, N_C] c_t;\ntypedef int[0, N_C] c_tx;\nchan decl[v_t], coll[v_t], vote[v_t];\nint[0,N_V] tally[c_t];\nint tally_sum;\nint[0,2] sh_dec; // 1 - inperson, 2 - by mail\nint[0,1] buff_mail[v_t]; // election package is delivered to mailbox\nint[0,N_C] sh_vt; // chosen candidate\nint[0,1] sh_sg; // signed form (honest+private casting)\nint ballots_received(){\n    meta int i, res=0;\n\tif(tally_sum!=0)return tally_sum;\n    for(i=1;i<=N_C;i++){\n        res+=tally[i];\n    }\n    return res;\n}"
    ],
    "template": [
      {
        "name": [
          {
            "_": "Voter",
            "$": {
              "x": "5",
              "y": "5"
            }
          }
        ],
        "parameter": [
          "v_t id"
        ],
        "declaration": [
          "// Place local declarations here.\nint[0,2] mem_dec;\nint[0,1] mem_sg;\nint[0,N_C] mem_vt;"
        ],
        "location": [
          {
            "$": {
              "id": "id0",
              "x": "64",
              "y": "-96"
            },
            "name": [
              {
                "_": "has",
                "$": {
                  "x": "56",
                  "y": "-80"
                }
              }
            ]
          },
          {
            "$": {
              "id": "id1",
              "x": "256",
              "y": "-96"
            },
            "name": [
              {
                "_": "voted",
                "$": {
                  "x": "240",
                  "y": "-80"
                }
              }
            ]
          },
          {
            "$": {
              "id": "id2",
              "x": "-128",
              "y": "-96"
            },
            "name": [
              {
                "_": "waits",
                "$": {
                  "x": "-152",
                  "y": "-80"
                }
              }
            ]
          },
          {
            "$": {
              "id": "id3",
              "x": "-320",
              "y": "-96"
            },
            "name": [
              {
                "_": "idle",
                "$": {
                  "x": "-336",
                  "y": "-80"
                }
              }
            ]
          }
        ],
        "init": [
          {
            "$": {
              "ref": "id3"
            }
          }
        ],
        "transition": [
          {
            "source": [
              {
                "$": {
                  "ref": "id0"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id1"
                }
              }
            ],
            "label": [
              {
                "_": "vt:c_tx,\nsg:int[0,1]",
                "$": {
                  "kind": "select",
                  "x": "128",
                  "y": "-312"
                }
              },
              {
                "_": "vote[id]!",
                "$": {
                  "kind": "synchronisation",
                  "x": "128",
                  "y": "-280"
                }
              },
              {
                "_": "sh_vt=vt,\nsh_sg=sg,\nmem_sg=sg,\nmem_vt=vt",
                "$": {
                  "kind": "assignment",
                  "x": "128",
                  "y": "-264"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "160",
                  "y": "-192"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id2"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id0"
                }
              }
            ],
            "label": [
              {
                "_": "mem_dec==2 && buff_mail[id]",
                "$": {
                  "kind": "guard",
                  "x": "-56",
                  "y": "0"
                }
              },
              {
                "_": "buff_mail[id]=0",
                "$": {
                  "kind": "assignment",
                  "x": "-56",
                  "y": "16"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "-32",
                  "y": "0"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id2"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id0"
                }
              }
            ],
            "label": [
              {
                "_": "mem_dec==1",
                "$": {
                  "kind": "guard",
                  "x": "-56",
                  "y": "-232"
                }
              },
              {
                "_": "coll[id]!",
                "$": {
                  "kind": "synchronisation",
                  "x": "-56",
                  "y": "-216"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "-32",
                  "y": "-192"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id3"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id2"
                }
              }
            ],
            "label": [
              {
                "_": "inperson:int[1,2]",
                "$": {
                  "kind": "select",
                  "x": "-256",
                  "y": "-264"
                }
              },
              {
                "_": "decl[id]!",
                "$": {
                  "kind": "synchronisation",
                  "x": "-256",
                  "y": "-248"
                }
              },
              {
                "_": "mem_dec=inperson,\nsh_dec=inperson",
                "$": {
                  "kind": "assignment",
                  "x": "-256",
                  "y": "-232"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "-224",
                  "y": "-192"
                }
              }
            ]
          }
        ]
      },
      {
        "name": [
          "Authority"
        ],
        "declaration": [
          "int[0,2] dec_recv[v_t];  // 1 - inperson, 2 - mailbox\nint[0,1] pack_sent[v_t];\nint[0,N_C] vt_recv[v_t]; \nint[0,1] sg_recv[v_t]; \nvoid foo(){\n    meta int i;\n    for(i=1;i<=N_V;i++){\n        dec_recv[i]=0;\n    }\n}"
        ],
        "location": [
          {
            "$": {
              "id": "id4",
              "x": "288",
              "y": "0"
            },
            "name": [
              {
                "_": "coll_vts",
                "$": {
                  "x": "256",
                  "y": "16"
                }
              }
            ]
          },
          {
            "$": {
              "id": "id5",
              "x": "128",
              "y": "0"
            },
            "name": [
              {
                "_": "send_ep",
                "$": {
                  "x": "56",
                  "y": "16"
                }
              }
            ]
          },
          {
            "$": {
              "id": "id6",
              "x": "-32",
              "y": "0"
            },
            "name": [
              {
                "_": "coll_dec",
                "$": {
                  "x": "-56",
                  "y": "16"
                }
              }
            ]
          }
        ],
        "init": [
          {
            "$": {
              "ref": "id6"
            }
          }
        ],
        "transition": [
          {
            "source": [
              {
                "$": {
                  "ref": "id4"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id4"
                }
              }
            ],
            "label": [
              {
                "_": "v_i:v_t",
                "$": {
                  "kind": "select",
                  "x": "256",
                  "y": "-152"
                }
              },
              {
                "_": "vote[v_i]?",
                "$": {
                  "kind": "synchronisation",
                  "x": "256",
                  "y": "-136"
                }
              },
              {
                "_": "tally[((sh_vt-1)+N_C)%N_C+1]=sh_sg && sh_vt>0 ? tally[sh_vt]+1 : tally[((sh_vt-1)+N_C)%N_C+1],\nsh_vt=0,\nsh_sg=0",
                "$": {
                  "kind": "assignment",
                  "x": "256",
                  "y": "-120"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "320",
                  "y": "-64"
                }
              },
              {
                "$": {
                  "x": "256",
                  "y": "-64"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id5"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id5"
                }
              }
            ],
            "label": [
              {
                "_": "v_i:v_t",
                "$": {
                  "kind": "select",
                  "x": "96",
                  "y": "64"
                }
              },
              {
                "_": "dec_recv[v_i]==2 &&\n!pack_sent[v_i]",
                "$": {
                  "kind": "guard",
                  "x": "96",
                  "y": "80"
                }
              },
              {
                "_": "buff_mail[v_i]=1,\npack_sent[v_i]++",
                "$": {
                  "kind": "assignment",
                  "x": "96",
                  "y": "112"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "96",
                  "y": "64"
                }
              },
              {
                "$": {
                  "x": "160",
                  "y": "64"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id5"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id5"
                }
              }
            ],
            "label": [
              {
                "_": "v_i:v_t",
                "$": {
                  "kind": "select",
                  "x": "96",
                  "y": "-151"
                }
              },
              {
                "_": "dec_recv[v_i]==1 &&\n!pack_sent[v_i]",
                "$": {
                  "kind": "guard",
                  "x": "96",
                  "y": "-136"
                }
              },
              {
                "_": "coll[v_i]?",
                "$": {
                  "kind": "synchronisation",
                  "x": "96",
                  "y": "-104"
                }
              },
              {
                "_": "pack_sent[v_i]++",
                "$": {
                  "kind": "assignment",
                  "x": "96",
                  "y": "-88"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "160",
                  "y": "-64"
                }
              },
              {
                "$": {
                  "x": "96",
                  "y": "-64"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id5"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id4"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id6"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id5"
                }
              }
            ]
          },
          {
            "source": [
              {
                "$": {
                  "ref": "id6"
                }
              }
            ],
            "target": [
              {
                "$": {
                  "ref": "id6"
                }
              }
            ],
            "label": [
              {
                "_": "v_i:v_t",
                "$": {
                  "kind": "select",
                  "x": "-120",
                  "y": "-128"
                }
              },
              {
                "_": "decl[v_i]?",
                "$": {
                  "kind": "synchronisation",
                  "x": "-120",
                  "y": "-112"
                }
              },
              {
                "_": "dec_recv[v_i]=sh_dec,\nsh_dec=0",
                "$": {
                  "kind": "assignment",
                  "x": "-120",
                  "y": "-96"
                }
              }
            ],
            "nail": [
              {
                "$": {
                  "x": "0",
                  "y": "-64"
                }
              },
              {
                "$": {
                  "x": "-64",
                  "y": "-64"
                }
              }
            ]
          }
        ]
      }
    ],
    "system": [
      "// Place template instantiations here.\n\n// List one or more processes to be composed into a system.\nsystem Voter, Authority;"
    ]
  }
}