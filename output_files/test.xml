<?xml version="1.0" encoding="utf-8"?>
        <!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'><nta>
  <declaration>// Place global declarations here.&#xD;
const int N_V = 5;&#xD;
const int N_C = 2;&#xD;
&#xD;
chan decl[N_V+1];&#xD;
chan coll[N_V+1];&#xD;
chan vote[N_V+1];&#xD;
int[0,N_V] tally[N_C+1];&#xD;
int tally_sum;&#xD;
int[0,2] sh_dec; // 1 - inperson, 2 - by mail&#xD;
int[0,1] buff_mail[N_V+1]; // election package is delivered to mailbox&#xD;
int[0,N_C] sh_vt; // chosen candidate&#xD;
int[0,1] sh_sg; // signed form (honest+private casting)&#xD;
&#xD;
int ballots_received(){&#xD;
    int i;&#xD;
	int res=0;&#xD;
	if(tally_sum!=0)return tally_sum;&#xD;
    for(i=1;i&lt;=N_C;i++){&#xD;
        res+=tally[i];&#xD;
    }&#xD;
    return res;&#xD;
}&#xD;
</declaration>
  <template>
    <name>Authority</name>
    <declaration>int [ 0, 2 ] Authority_dec_recv; int [ 0, 1 ] Authority_pack_sent; int [ 0, N_C ] Authority_vt_recv; int [ 0, 1 ] Authority_sg_recv;</declaration>
    <location id="id4" x="288" y="0">
      <name x="256" y="16">coll_vts</name>
    </location>
    <location id="id5" x="128" y="0">
      <name x="56" y="16">send_ep</name>
    </location>
    <location id="id6" x="-32" y="0">
      <name x="-56" y="16">coll_dec</name>
    </location>
    <init ref="id6"/>
    <transition>
      <source ref="id4"/>
      <target ref="id4"/>
      <label kind="select" x="256" y="-152">v_i:int[1,N_V]</label>
      <label kind="synchronisation" x="256" y="-136">vote[v_i]?</label>
      <label kind="assignment" x="256" y="-120">Authority_tally [ ( ( Authority_sh_vt - 1 ) + N_C ) % N_C + 1 ] = Authority_sh_sg &amp;&amp; Authority_sh_vt &gt; 0 ? Authority_tally [ Authority_sh_vt ] + 1 : Authority_tally [ ( ( Authority_sh_vt - 1 ) + N_C ) % N_C + 1 ], Authority_sh_vt = 0, Authority_sh_sg = 0</label>
      <nail x="320" y="-64"/>
      <nail x="256" y="-64"/>
    </transition>
    <transition>
      <source ref="id5"/>
      <target ref="id5"/>
      <label kind="select" x="96" y="64">v_i:int[1,N_V]</label>
      <label kind="guard" x="96" y="80">Authority_dec_recv [ Authority_v_i ] == 2 &amp;&amp; ! Authority_pack_sent [ Authority_v_i ]</label>
      <label kind="assignment" x="96" y="112">Authority_buff_mail [ Authority_v_i ] = 1, Authority_pack_sent [ Authority_v_i ] += 1</label>
      <nail x="96" y="64"/>
      <nail x="160" y="64"/>
    </transition>
    <transition>
      <source ref="id5"/>
      <target ref="id5"/>
      <label kind="select" x="96" y="-151">v_i:int[1,N_V]</label>
      <label kind="guard" x="96" y="-136">Authority_dec_recv [ Authority_v_i ] == 1 &amp;&amp; ! Authority_pack_sent [ Authority_v_i ]</label>
      <label kind="synchronisation" x="96" y="-104">coll[v_i]?</label>
      <label kind="assignment" x="96" y="-88">Authority_pack_sent [ Authority_v_i ] += 1</label>
      <nail x="160" y="-64"/>
      <nail x="96" y="-64"/>
    </transition>
    <transition>
      <source ref="id5"/>
      <target ref="id4"/>
    </transition>
    <transition>
      <source ref="id6"/>
      <target ref="id5"/>
    </transition>
    <transition>
      <source ref="id6"/>
      <target ref="id6"/>
      <label kind="select" x="-120" y="-128">v_i:int[1,N_V]</label>
      <label kind="synchronisation" x="-120" y="-112">decl[v_i]?</label>
      <label kind="assignment" x="-120" y="-96">Authority_dec_recv [ Authority_v_i ] = Authority_sh_dec, Authority_sh_dec = 0</label>
      <nail x="0" y="-64"/>
      <nail x="-64" y="-64"/>
    </transition>
  </template>
  <template>
    <name>Voter_1</name>
    <declaration>const int id = 1;
int [ 0, 2 ] Voter_1_mem_dec; int [ 0, 1 ] Voter_1_mem_sg; int [ 0, N_C ] Voter_1_mem_vt;</declaration>
    <location id="id0" x="64" y="-96"/>
    <location id="id1" x="256" y="-96">
      <name x="246" y="-85">end</name>
    </location>
    <location id="id2" x="-128" y="-96">
      <name x="-152" y="-80">waits</name>
    </location>
    <location id="id3" x="-320" y="-96">
      <name x="-336" y="-80">idle</name>
    </location>
    <init ref="id3"/>
    <transition>
      <source ref="id0"/>
      <target ref="id1"/>
      <label kind="select" x="128" y="-312">vt:int[0,N_C],
sg:int[0,1]</label>
      <label kind="synchronisation" x="128" y="-280">vote[id]!</label>
      <label kind="assignment" x="128" y="-264">Voter_1_sh_vt = Voter_1_vt, Voter_1_sh_sg = Voter_1_sg, Voter_1_mem_sg = Voter_1_sg, Voter_1_mem_vt = Voter_1_vt</label>
      <nail x="160" y="-192"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="0">Voter_1_mem_vt == 2 &amp;&amp; Voter_1_buff_mail [ 1 ]</label>
      <label kind="assignment" x="-56" y="16">Voter_1_buff_mail [ 1 ] = 0</label>
      <nail x="-32" y="0"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="-232">Voter_1_mem_dec == 1</label>
      <label kind="synchronisation" x="-56" y="-216">coll[id]!</label>
      <nail x="-32" y="-192"/>
    </transition>
    <transition>
      <source ref="id3"/>
      <target ref="id2"/>
      <label kind="select" x="-256" y="-264">inperson:int[1,2]</label>
      <label kind="synchronisation" x="-256" y="-248">decl[id]!</label>
      <label kind="assignment" x="-256" y="-232">Voter_1_mem_dec = Voter_1_inperson, Voter_1_sh_dec = Voter_1_inperson</label>
      <nail x="-224" y="-192"/>
    </transition>
  </template>
  <template>
    <name>Voter_2</name>
    <declaration>const int id = 2;
int [ 0, 2 ] Voter_2_mem_dec; int [ 0, 1 ] Voter_2_mem_sg; int [ 0, N_C ] Voter_2_mem_vt;</declaration>
    <location id="id0" x="64" y="-96"/>
    <location id="id1" x="256" y="-96">
      <name x="246" y="-85">end</name>
    </location>
    <location id="id2" x="-128" y="-96">
      <name x="-152" y="-80">waits</name>
    </location>
    <location id="id3" x="-320" y="-96">
      <name x="-336" y="-80">idle</name>
    </location>
    <init ref="id3"/>
    <transition>
      <source ref="id0"/>
      <target ref="id1"/>
      <label kind="select" x="128" y="-312">vt:int[0,N_C],
sg:int[0,1]</label>
      <label kind="synchronisation" x="128" y="-280">vote[id]!</label>
      <label kind="assignment" x="128" y="-264">Voter_2_sh_vt = Voter_2_vt, Voter_2_sh_sg = Voter_2_sg, Voter_2_mem_sg = Voter_2_sg, Voter_2_mem_vt = Voter_2_vt</label>
      <nail x="160" y="-192"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="0">Voter_2_mem_vt == 2 &amp;&amp; Voter_2_buff_mail [ 2 ]</label>
      <label kind="assignment" x="-56" y="16">Voter_2_buff_mail [ 2 ] = 0</label>
      <nail x="-32" y="0"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="-232">Voter_2_mem_dec == 1</label>
      <label kind="synchronisation" x="-56" y="-216">coll[id]!</label>
      <nail x="-32" y="-192"/>
    </transition>
    <transition>
      <source ref="id3"/>
      <target ref="id2"/>
      <label kind="select" x="-256" y="-264">inperson:int[1,2]</label>
      <label kind="synchronisation" x="-256" y="-248">decl[id]!</label>
      <label kind="assignment" x="-256" y="-232">Voter_2_mem_dec = Voter_2_inperson, Voter_2_sh_dec = Voter_2_inperson</label>
      <nail x="-224" y="-192"/>
    </transition>
  </template>
  <template>
    <name>Voter_3</name>
    <declaration>const int id = 3;
int [ 0, 2 ] Voter_3_mem_dec; int [ 0, 1 ] Voter_3_mem_sg; int [ 0, N_C ] Voter_3_mem_vt;</declaration>
    <location id="id0" x="64" y="-96"/>
    <location id="id1" x="256" y="-96">
      <name x="246" y="-85">end</name>
    </location>
    <location id="id2" x="-128" y="-96">
      <name x="-152" y="-80">waits</name>
    </location>
    <location id="id3" x="-320" y="-96">
      <name x="-336" y="-80">idle</name>
    </location>
    <init ref="id3"/>
    <transition>
      <source ref="id0"/>
      <target ref="id1"/>
      <label kind="select" x="128" y="-312">vt:int[0,N_C],
sg:int[0,1]</label>
      <label kind="synchronisation" x="128" y="-280">vote[id]!</label>
      <label kind="assignment" x="128" y="-264">Voter_3_sh_vt = Voter_3_vt, Voter_3_sh_sg = Voter_3_sg, Voter_3_mem_sg = Voter_3_sg, Voter_3_mem_vt = Voter_3_vt</label>
      <nail x="160" y="-192"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="0">Voter_3_mem_vt == 2 &amp;&amp; Voter_3_buff_mail [ 3 ]</label>
      <label kind="assignment" x="-56" y="16">Voter_3_buff_mail [ 3 ] = 0</label>
      <nail x="-32" y="0"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="-232">Voter_3_mem_dec == 1</label>
      <label kind="synchronisation" x="-56" y="-216">coll[id]!</label>
      <nail x="-32" y="-192"/>
    </transition>
    <transition>
      <source ref="id3"/>
      <target ref="id2"/>
      <label kind="select" x="-256" y="-264">inperson:int[1,2]</label>
      <label kind="synchronisation" x="-256" y="-248">decl[id]!</label>
      <label kind="assignment" x="-256" y="-232">Voter_3_mem_dec = Voter_3_inperson, Voter_3_sh_dec = Voter_3_inperson</label>
      <nail x="-224" y="-192"/>
    </transition>
  </template>
  <template>
    <name>Voter_4</name>
    <declaration>const int id = 4;
int [ 0, 2 ] Voter_4_mem_dec; int [ 0, 1 ] Voter_4_mem_sg; int [ 0, N_C ] Voter_4_mem_vt;</declaration>
    <location id="id0" x="64" y="-96"/>
    <location id="id1" x="256" y="-96">
      <name x="246" y="-85">end</name>
    </location>
    <location id="id2" x="-128" y="-96">
      <name x="-152" y="-80">waits</name>
    </location>
    <location id="id3" x="-320" y="-96">
      <name x="-336" y="-80">idle</name>
    </location>
    <init ref="id3"/>
    <transition>
      <source ref="id0"/>
      <target ref="id1"/>
      <label kind="select" x="128" y="-312">vt:int[0,N_C],
sg:int[0,1]</label>
      <label kind="synchronisation" x="128" y="-280">vote[id]!</label>
      <label kind="assignment" x="128" y="-264">Voter_4_sh_vt = Voter_4_vt, Voter_4_sh_sg = Voter_4_sg, Voter_4_mem_sg = Voter_4_sg, Voter_4_mem_vt = Voter_4_vt</label>
      <nail x="160" y="-192"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="0">Voter_4_mem_vt == 2 &amp;&amp; Voter_4_buff_mail [ 4 ]</label>
      <label kind="assignment" x="-56" y="16">Voter_4_buff_mail [ 4 ] = 0</label>
      <nail x="-32" y="0"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="-232">Voter_4_mem_dec == 1</label>
      <label kind="synchronisation" x="-56" y="-216">coll[id]!</label>
      <nail x="-32" y="-192"/>
    </transition>
    <transition>
      <source ref="id3"/>
      <target ref="id2"/>
      <label kind="select" x="-256" y="-264">inperson:int[1,2]</label>
      <label kind="synchronisation" x="-256" y="-248">decl[id]!</label>
      <label kind="assignment" x="-256" y="-232">Voter_4_mem_dec = Voter_4_inperson, Voter_4_sh_dec = Voter_4_inperson</label>
      <nail x="-224" y="-192"/>
    </transition>
  </template>
  <template>
    <name>Voter_5</name>
    <declaration>const int id = 5;
int [ 0, 2 ] Voter_5_mem_dec; int [ 0, 1 ] Voter_5_mem_sg; int [ 0, N_C ] Voter_5_mem_vt;</declaration>
    <location id="id0" x="64" y="-96"/>
    <location id="id1" x="256" y="-96">
      <name x="246" y="-85">end</name>
    </location>
    <location id="id2" x="-128" y="-96">
      <name x="-152" y="-80">waits</name>
    </location>
    <location id="id3" x="-320" y="-96">
      <name x="-336" y="-80">idle</name>
    </location>
    <init ref="id3"/>
    <transition>
      <source ref="id0"/>
      <target ref="id1"/>
      <label kind="select" x="128" y="-312">vt:int[0,N_C],
sg:int[0,1]</label>
      <label kind="synchronisation" x="128" y="-280">vote[id]!</label>
      <label kind="assignment" x="128" y="-264">Voter_5_sh_vt = Voter_5_vt, Voter_5_sh_sg = Voter_5_sg, Voter_5_mem_sg = Voter_5_sg, Voter_5_mem_vt = Voter_5_vt</label>
      <nail x="160" y="-192"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="0">Voter_5_mem_vt == 2 &amp;&amp; Voter_5_buff_mail [ 5 ]</label>
      <label kind="assignment" x="-56" y="16">Voter_5_buff_mail [ 5 ] = 0</label>
      <nail x="-32" y="0"/>
    </transition>
    <transition>
      <source ref="id2"/>
      <target ref="id0"/>
      <label kind="guard" x="-56" y="-232">Voter_5_mem_dec == 1</label>
      <label kind="synchronisation" x="-56" y="-216">coll[id]!</label>
      <nail x="-32" y="-192"/>
    </transition>
    <transition>
      <source ref="id3"/>
      <target ref="id2"/>
      <label kind="select" x="-256" y="-264">inperson:int[1,2]</label>
      <label kind="synchronisation" x="-256" y="-248">decl[id]!</label>
      <label kind="assignment" x="-256" y="-232">Voter_5_mem_dec = Voter_5_inperson, Voter_5_sh_dec = Voter_5_inperson</label>
      <nail x="-224" y="-192"/>
    </transition>
  </template>
  <system>// Place template instantiations here.&#xD;
&#xD;
// List one or more processes to be composed into a system.&#xD;
system Voter, Authority;</system>
  <queries>
    <query>
      <formula>A[]1==1</formula>
      <comment/>
    </query>
  </queries>
</nta>